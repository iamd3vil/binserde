// Code generated by binserde(Build: {{ .BuildString }}). DO NOT EDIT.
package {{.Pkg}}

import (
    "encoding/binary"
    "io"
)

{{- range .MarshalStructs}}
func (s *{{.StructName}}) Marshal(wr io.Writer) error {
    buf := make([]byte, 8)
    var (
        byBuf []byte
        err error
    )
    {{- range .Fields}}
        {{- if not .Append}}
            binary.{{$.Endian}}.{{.Func}}(buf[:{{.Offset}}], {{.FieldName}})
            _, err = wr.Write(buf[:{{.Offset}}])
            if err != nil {
                return err
            }
        {{- else}}
            {{- if not .HasToBeMarshalled }}
                byBuf = make([]byte, len({{.FieldName}}))
                copy(byBuf, {{.FieldName}})
                _, err = wr.Write(byBuf)
                if err != nil {
                    return err
                }
            {{- else }}
                if err := {{.FieldName}}.Marshal(wr); err != nil {
                    return err
                }
            {{- end}}
        {{- end}}
    {{- end}}
    return nil
}

func (s *{{.StructName}}) Size() int {
    ln := 0
    {{- range .Fields}}
        ln += {{.Offset}}
    {{- end}}
    return ln
}
{{- end}}



{{- range .UnmarshalStructs}}
func (s *{{.StructName}}) Unmarshal(rdr io.Reader) error {
    buf := make([]byte, 8)
    {{- range .Fields}}
        {{- if .Append}}
            s.{{.FieldName}} = make([]byte, {{.Offset}})
            if _, err := io.ReadFull(rdr, s.{{.FieldName}}); err != nil {
                return err
            }
        {{- else if .String}}
            buf{{.FieldName}} := make([]byte, {{.Offset}})
            if _, err := io.ReadFull(rdr, buf{{.FieldName}}); err != nil {
                return err
            }
            s.{{.FieldName}} = string(buf{{.FieldName}})
        {{- else if .Struct}}
            if err := s.{{.FieldName}}.Unmarshal(rdr); err != nil {
                return err
            }
        {{- else}}
            if _, err := io.ReadFull(rdr, buf[:{{.Offset}}]); err != nil {
                return err
            }
            s.{{.FieldName}} = {{.Type}}(binary.{{$.Endian}}.{{.Func}}(buf[:{{.Offset}}]))
        {{- end}}
        
    {{- end}}
    return nil
}
{{- end}}